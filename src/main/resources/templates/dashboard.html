<html xmlns:th="http://www.w3.org/1999/xhtml" lang="es">

    <head>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Fundme</title>

        <style>

            body {
                font-family: Arial, sans-serif;
                background-color: #f0f0f0;
                margin: 0;
                padding: 0;
            }

            .container { display: flex; }

            .sidebar {
                background-color: #333;
                color: #fff;
                width: 250px;
                padding: 20px;
                min-height: 100vh;
            }

            .sidebar h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .sidebar ul {
                list-style: none;
                padding: 0;
            }

            .sidebar li { margin-bottom: 10%; }

            .sidebar a {
                text-decoration: none;
                color: #fff;
                display: block;
            }

            .content {
                flex: 1;
                padding: 20px;
            }

            table {
                width: 100%;
                padding: 10px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                border-radius: 5px;
                margin: 0 auto;
                margin-bottom: 3%;
                background-color: #fff;
            }

            table th {
                font-size: 18px;
                background-color: #333;
                color: #fff;
                padding: 12px;
            }

            table th, table td {
                padding: 10px;
                text-align: center;
                font-size: 15px;
            }

            tbody tr:nth-child(even) { background-color: #f5f5f5; }

            tbody tr:hover { background-color: #ddd; }

            .section {
                background-color: #fff;
                border-radius: 5px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                padding: 20px;
                margin-bottom: 20px;
            }

            h3 {
                font-size: 24px;
                text-align: center;
                margin: 2% auto;
            }

            .project {
                background-color: #fff;
                padding: 20px;
                border-radius: 5px;
                text-align: center;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                width: 85%;
                margin: 3% auto;
                border-radius: 5px;
            }

            .project h3 {
                font-size: 17.5px;
                margin-bottom: 2%;
            }

            .details-link {
                color: #0074d9;
                text-decoration: none;
            }

            .details-link:visited { color: #7a7a7a; }

            .search-section {
                background-color: #f5f5f5;
                border-radius: 5px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                padding: 20px;
                margin-bottom: 20px;
            }

            .search-input {
                width: 100%;
                padding: 10px;
                border: 1px solid #ccc;
                border-radius: 5px;
                font-size: 16px;
            }

            .search-input:hover, .search-input:focus { border-color: #333; }

            .search-button {
                background-color: #333;
                color: #fff;
                padding: 10px 20px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
            }

            .search-button:hover { background-color: #555; }

            .autocomplete-item {
                padding: 10px;
                cursor: pointer;
                border-bottom: 1px solid #ccc;
            }

            .autocomplete-item a {
                text-decoration: none;
                color: #333;
                font-weight: bold;
            }

            .autocomplete-item a:hover { text-decoration: underline; }

            .autocomplete-item:last-child { border-bottom: none; }

            .autocomplete-item:hover { background-color: #e5e5e5; }

        </style>

    </head>

    <body>

        <div class="container">

            <div class="sidebar">

                <h1>FUNDMEPLS</h1>

                <ul>

                    <li><a th:href="@{/fundme/controller/web/dashboard}">#</a></li>
                    <li><a th:href="@{/fundme/controller/web/projects}">Projects</a></li>
                    <li><a th:href="@{/fundme/controller/web/donations}">Donations</a></li>
                    <li><a th:href="@{/fundme/controller/web/userProfile}">User profile</a></li>
                    <li><a th:href="@{/fundme/controller/web/notifications}">Notifications</a></li>
                    <li><a th:href="@{/fundme/controller/web/logout}">Logout</a></li>

                </ul>

            </div>

            <div class="content">

                <div class="search-section">

                    <form action="/fundme/controller/web/search" method="get">

                        <input class="search-input" type="text" id="search-input" name="query" placeholder="Buscar..." />

                        <div id="autocomplete-results"></div>

                    </form>

                </div>

                <div class="section" id="top-donations">

                    <h3>Top Donations</h3>

                    <table>

                        <thead>

                            <tr>

                                <th>Date</th>
                                <th>User</th>
                                <th>Project</th>
                                <th>Amount</th>

                            </tr>

                        </thead>

                        <tbody>

                            <tr th:each="donation : ${topDonationsList}">

                                <td th:text="${#dates.format(donation.dateAdded, 'yyyy/MM/dd')}"></td>
                                <td><a class="details-link" th:href="@{'/fundme/controller/web/userProfile/' + ${donation.userId.userId}}" th:text="${donation.userId.name}"></a></td>
                                <td><a class="details-link" th:href="@{'/fundme/controller/web/viewProject/' + ${donation.projectId.projectId}}" th:text="${donation.projectId.title}"></a></td>
                                <td th:text="${donation.amount}"></td>

                            </tr>

                        </tbody>

                    </table>

                </div>

                <div class="section" id="top-projects">

                    <h3>Top Projects</h3>

                    <table>

                        <thead>

                            <tr>

                                <th>Date</th>
                                <th>User</th>
                                <th>Title</th>
                                <th>Description</th>
                                <th>Amount</th>
                            </tr>

                        </thead>

                        <tbody>

                            <tr th:each="project : ${topProjectsList}">

                                <td th:text="${#dates.format(project.dateAdded, 'yyyy/MM/dd')}"></td>
                                <td><a class="details-link" th:href="@{'/fundme/controller/web/userProfile/' + ${project.userId.userId}}" th:text="${project.userId.name}"></a></td>
                                <td><a class="details-link" th:href="@{'/fundme/controller/web/viewProject/' + ${project.projectId}}" th:text="${project.title}">Title</a></td>
                                <td th:text="${project.description}"></td>
                                <td th:text="${project.totalAmount}"></td>

                            </tr>

                        </tbody>

                    </table>

                </div>

            </div>

        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <script>

            $(document).ready(function() {

                $("#search-input").on("input", function() {

                    var query = $(this).val();

                    if (query.length >= 3) {

                        $.ajax({

                            url: "/fundme/controller/web/search",
                            method: "GET",
                            headers: {

                                "X-Requested-With": "XMLHttpRequest", // Indica que es una solicitud AJAX
                                "X-User-Role": "AJAX_ROLE" // Define el rol del usuario como "AJAX_ROLE"

                            },

                            data: { query: query },
                            success: function(data) { displayResults(data); }
                        });

                    } else { $("#autocomplete-results").empty(); }
                });

                function displayResults(results) {

                    var resultsList = $("#autocomplete-results");
                    resultsList.empty();

                    results.forEach(function(result) {

                        var listItem = "<div class='autocomplete-item'>";

                        if (result.type === "Project") {

                            listItem += "<a href='/fundme/controller/web/viewProject/" + result.entity.projectId + "'>Project: " + result.entity.title + "</a>";

                        } else if (result.type === "User") {

                            listItem += "<a href='/fundme/controller/web/userProfile/" + result.entity.userId + "'>User: " + result.entity.username + "</a>";

                        }

                        listItem += "</div>";
                        resultsList.append(listItem);

                    });

                }

            });

        </script>

    </body>

</html>